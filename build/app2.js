"use strict";(()=>{var e=class o{static{this.GRID_SIZE=100}static{this.CANVAS_WIDTH=600}static{this.CANVAS_HEIGHT=600}static{this.CELL_SIZE=o.CANVAS_WIDTH/o.GRID_SIZE}static{this.OBSTACLE_OPENING=25}static{this.OBSTACLE_WIDTH=12}static{this.OBSTACLE_VELOCITY=-25}static{this.GROUND_HEIGHT=10}static{this.GRAVITY=-150}static{this.JUMP_VELOCITY=60}};var b=class{constructor(t){this.game=t,this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d"),this.ctx.lineWidth=2,this.ctx.strokeStyle="#121212",this.canvas.addEventListener("mousedown",()=>t.getInputHandler().processClick())}render(){this.drawBackground();let t=this.game.getObstacleManager().getObstacles();for(let i of t)i.render(this.ctx);this.game.getPlayer().render(this.ctx),this.game.gameState()!==2?this.renderScore():this.renderGameOverScreen(),this.renderDebug()}renderDebug(){this.ctx.textAlign="left",this.ctx.fillStyle="black",this.ctx.font="12px 'Roboto'",this.ctx.fillText(`Delta: ${this.game.getTimeDelta()}`,10,15),this.ctx.fillText(`Accel: ${this.game.getPlayer().getMovableComponent().getAccelerationY()}, Velocity: ${this.game.getPlayer().getMovableComponent().getVelocityY()}`,10,30),this.ctx.fillText(`Pos: ${this.game.getPlayer().getMovableComponent().getPosition().getX()}, ${this.game.getPlayer().getMovableComponent().getPosition().getY()}`,10,45)}renderGameOverScreen(){let t=this.game.getPlayer(),i=30*e.CELL_SIZE,s=35*e.CELL_SIZE,a=this.canvas.width/2-i/2,n=this.canvas.height/2.5-s/2;this.ctx.textAlign="center",this.ctx.font="36px 'Impact'",this.ctx.fillStyle="#c99868",this.ctx.beginPath(),this.ctx.roundRect(a,n,i,s,5),this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="white",this.ctx.save(),this.ctx.translate(a,n),this.ctx.fillText("Score:",i/2,s/3),this.ctx.strokeText("Score:",i/2,s/3),this.ctx.fillText(`${t.getScore()}`,i/2,s/2),this.ctx.strokeText(`${t.getScore()}`,i/2,s/2),this.ctx.restore()}renderScore(){let t=this.game.getPlayer();this.ctx.textAlign="center",this.ctx.fillStyle="white",this.ctx.font="48px 'Impact'",this.ctx.fillText(`${t.getScore()}`,this.canvas.width/2,this.canvas.height/8),this.ctx.strokeText(`${t.getScore()}`,this.canvas.width/2,this.canvas.height/8)}drawBackground(){this.ctx.fillStyle="#8dcdff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#ffe284",this.ctx.fillRect(0,this.canvas.height-e.GROUND_HEIGHT*e.CELL_SIZE,this.canvas.width,e.GROUND_HEIGHT*e.CELL_SIZE),this.ctx.strokeRect(0,this.canvas.height-e.GROUND_HEIGHT*e.CELL_SIZE,this.canvas.width,e.GROUND_HEIGHT*e.CELL_SIZE)}};var v=class{constructor(t){this.game=t}processClick(){this.game.gameState()===0&&this.game.setGameState(1),this.game.gameState()!==2?this.game.getPlayer().jump():this.game.restart()}};var d=class{constructor(t,i){this.x=t,this.y=i}getX(){return this.x}getY(){return this.y}setX(t){this.x=t}setY(t){this.y=t}moveX(t){this.x+=t}moveY(t){this.y+=t}getCanvasX(){return this.x*e.CELL_SIZE}getCanvasY(){return e.CANVAS_HEIGHT-this.y*e.CELL_SIZE}};var l=class{constructor(t,i,s,a){this.velocityX=0;this.velocityY=0;this.accelerationX=0;this.accelerationY=0;this.position=new d(t,i),this.width=s,this.height=a}updatePosition(t){this.velocityX+=this.accelerationX*t,this.velocityY+=this.accelerationY*t,!(this.position.getY()<e.GROUND_HEIGHT)&&(this.position.moveX(this.velocityX*t),this.position.moveY(this.velocityY*t))}intersects(t){let i=this.position.getX(),s=this.position.getY(),a=this.position.getX()+this.width,n=this.position.getY()+this.height,r=t.getPosition().getX(),g=t.getPosition().getY(),I=t.getPosition().getX()+t.getWidth(),f=t.getPosition().getY()+t.getHeight();return i<=I&&a>=r&&s<=f&&n>=g}setVelocityX(t){this.velocityX=t}setVelocityY(t){this.velocityY=t}setAccelerationX(t){this.accelerationX=t}setAccelerationY(t){this.accelerationY=t}getWidth(){return this.width}getHeight(){return this.height}getCanvasWidth(){return this.width*e.CELL_SIZE}getCanvasHeight(){return-(this.height*e.CELL_SIZE)}getPosition(){return this.position}getAccelerationY(){return this.accelerationY}getVelocityY(){return this.velocityY}};var c=class{constructor(){this.score=0;this.pointAwarded=!1;this.movableComponent=new l(e.GRID_SIZE/5,e.GRID_SIZE/2,9,9),this.movableComponent.setAccelerationY(e.GRAVITY),this.birb=new Image(25,25),this.birb.src="./images/birb.png"}getScore(){return this.score}increaseScore(){this.score+=1}getMovableComponent(){return this.movableComponent}setPointAwarded(t){this.pointAwarded=t}getPointAwarded(){return this.pointAwarded}getX(){return this.movableComponent.getPosition().getX()}jump(){this.movableComponent.setVelocityY(e.JUMP_VELOCITY)}getRotation(){let t=this.movableComponent.getVelocityY();return t>20?-(Math.PI/6):t<-10?Math.PI/3:0}render(t){let i=this.movableComponent.getCanvasWidth(),s=this.movableComponent.getCanvasHeight();t.save(),t.translate(this.movableComponent.getPosition().getCanvasX()+i/2,this.movableComponent.getPosition().getCanvasY()+s/2),t.rotate(this.getRotation()),t.drawImage(this.birb,-(i/2),-(s/2),i,s),t.restore()}};var h=class{constructor(t,i,s,a){this.movableComponent=new l(t,i,s,a),this.movableComponent.setVelocityX(e.OBSTACLE_VELOCITY)}getMovableComponent(){return this.movableComponent}getPosition(){return this.movableComponent.getPosition()}getWidth(){return this.movableComponent.getWidth()}getHeight(){return this.movableComponent.getHeight()}getCanvasWidth(){return this.movableComponent.getCanvasWidth()}getCanvasHeight(){return this.movableComponent.getCanvasHeight()}render(t){this.renderObstacle(t),this.renderObstacleEntrance(t)}renderObstacle(t){let i=this.getPosition().getCanvasX(),s=this.getPosition().getCanvasY(),a=t.createLinearGradient(i,0,i+this.getCanvasWidth(),0);a.addColorStop(0,"#84c887"),a.addColorStop(.2,"#6fbf73"),a.addColorStop(.3,"#6fbf73"),a.addColorStop(.5,"#4caf50"),a.addColorStop(.8,"#357a38"),a.addColorStop(1,"#4caf50"),t.fillStyle=a,t.lineWidth=2,t.fillRect(i,s,this.getCanvasWidth(),this.getCanvasHeight()),t.strokeRect(i,s,this.getCanvasWidth(),this.getCanvasHeight())}renderObstacleEntrance(t){let i=this.getPosition().getCanvasY(),s=3,a=e.OBSTACLE_WIDTH+2,n=(a-e.OBSTACLE_WIDTH)/2,r=this.getPosition().getX()-n;if(this.getPosition().getY()===e.GROUND_HEIGHT){let g=i+this.getCanvasHeight();t.fillRect(r*e.CELL_SIZE,g,a*e.CELL_SIZE,s*e.CELL_SIZE),t.strokeRect(r*e.CELL_SIZE,g,a*e.CELL_SIZE,s*e.CELL_SIZE)}else t.fillRect(r*e.CELL_SIZE,i-s*e.CELL_SIZE,a*e.CELL_SIZE,s*e.CELL_SIZE),t.strokeRect(r*e.CELL_SIZE,i-s*e.CELL_SIZE,a*e.CELL_SIZE,s*e.CELL_SIZE)}};var m=class{constructor(t){this.game=t,this.obstacles=new Array,this.obstacleTimer=0}getObstacles(){return this.obstacles}update(t){this.game.gameState()===1&&this.processObstacles(t)}processObstacles(t){let i=this.game.getPlayer();for(let s=this.obstacles.length-1;s>=0;s--){let a=this.obstacles[s];if(a.getPosition().getX()+a.getWidth()<=0){this.obstacles.splice(s,1);continue}if(s<2&&a.getMovableComponent().intersects(this.game.getPlayer().getMovableComponent())){this.game.setGameState(2);continue}s==0&&(!i.getPointAwarded()&&i.getX()>a.getPosition().getX()&&i.getX()<a.getPosition().getX()+a.getWidth()?(i.setPointAwarded(!0),i.increaseScore()):i.getX()>a.getPosition().getX()+a.getWidth()&&i.setPointAwarded(!1)),a.getMovableComponent().updatePosition(t)}this.handleObstacleSpawning(t)}handleObstacleSpawning(t){this.obstacleTimer+=t,this.obstacleTimer>2&&(this.spawnObstacle(),this.obstacleTimer=0)}spawnObstacle(){let t=e.OBSTACLE_OPENING+4,i=e.GRID_SIZE-e.GROUND_HEIGHT-e.OBSTACLE_OPENING,s=Math.floor(Math.random()*(i-t+1)+t),a=e.GRID_SIZE-e.GROUND_HEIGHT-s,n=new h(e.GRID_SIZE,e.GRID_SIZE-a,e.OBSTACLE_WIDTH,a),r=new h(e.GRID_SIZE,e.GROUND_HEIGHT,e.OBSTACLE_WIDTH,s-e.OBSTACLE_OPENING);this.obstacles.push(n),this.obstacles.push(r)}};var p=class{constructor(t){this.game=t}update(t){let i=this.game.getPlayer();this.game.gameState()!==0&&i.getMovableComponent().updatePosition(t),this.game.gameState()!==2&&i.getMovableComponent().getPosition().getY()<=e.GROUND_HEIGHT&&this.game.setGameState(2)}};var C=class{constructor(){this.tick=t=>{this.deltaTime=(t-this.timestampOld)/1e3,this.timestampOld=t,this.playerManager.update(this.deltaTime),this.obstacleManager.update(this.deltaTime),this.gameRenderer.render(),window.requestAnimationFrame(this.tick)};this.player=new c,this.inputHandler=new v(this),this.gameRenderer=new b(this),this.obstacleManager=new m(this),this.playerManager=new p(this),this.state=0,this.deltaTime=0,this.timestampOld=0}getPlayer(){return this.player}getInputHandler(){return this.inputHandler}gameState(){return this.state}setGameState(t){this.state=t}getTimeDelta(){return this.deltaTime}getObstacleManager(){return this.obstacleManager}getPlayerManager(){return this.playerManager}restart(){this.player=new c,this.obstacleManager=new m(this),this.playerManager=new p(this),this.state=0,this.deltaTime=0,this.timestampOld=0}};var E;function S(){E=new C,window.requestAnimationFrame(E.tick)}window.onload=S;})();
