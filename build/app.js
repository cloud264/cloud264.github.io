"use strict";(()=>{var i=class{static{this.GRID_SIZE_X=720}static{this.GRID_SIZE_Y=1280}static{this.OBSTACLE_OPENING=250}static{this.OBSTACLE_WIDTH=120}static{this.OBSTACLE_VELOCITY=-250}static{this.GROUND_HEIGHT=100}static{this.GRAVITY=-1500}static{this.JUMP_VELOCITY=600}};var v=class{constructor(t){this.game=t,this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d");let e=window.devicePixelRatio;this.canvas.width=this.canvas.clientWidth*e,this.canvas.height=this.canvas.clientHeight*e,this.canvas.addEventListener("mousedown",()=>t.getInputHandler().processClick()),window.addEventListener("resize",()=>{this.canvas.width=this.canvas.clientWidth*e,this.canvas.height=this.canvas.clientHeight*e})}cellSizeX(){return this.canvas.width/i.GRID_SIZE_X}cellSizeY(){return this.canvas.height/i.GRID_SIZE_Y}canvasWidth(){return this.canvas.width}canvasHeight(){return this.canvas.height}toScreenWidth(t){return t*this.cellSizeX()}toScreenHeight(t){return-(t*this.cellSizeY())}toScreenX(t){return t*this.cellSizeX()}toScreenY(t){return this.canvas.height-t*this.cellSizeY()}canvasRenderingContext2D(){return this.ctx}render(){this.drawBackground();let t=this.game.getObstacleManager().getObstacles();for(let e of t)e.render(this);this.game.getPlayer().render(this),this.game.gameState()!==2?this.renderScore():this.renderGameOverScreen(),this.renderDebug()}renderDebug(){this.ctx.textAlign="left",this.ctx.fillStyle="black",this.ctx.font="12px 'Roboto'",this.ctx.fillText(`Delta: ${this.game.getTimeDelta()}`,10,15),this.ctx.fillText(`Accel: ${this.game.getPlayer().getMovableComponent().getAccelerationY()}, Velocity: ${this.game.getPlayer().getMovableComponent().getVelocityY()}`,10,30),this.ctx.fillText(`Pos: ${this.game.getPlayer().getMovableComponent().getPosition().getX()}, ${this.game.getPlayer().getMovableComponent().getPosition().getY()}`,10,45)}renderGameOverScreen(){let t=this.game.getPlayer(),e=this.toScreenWidth(i.GRID_SIZE_X/3),s=this.toScreenHeight(i.GRID_SIZE_Y/4),o=this.toScreenX(i.GRID_SIZE_X/2)-e/2,n=this.toScreenY(i.GRID_SIZE_Y/2)+this.toScreenHeight(i.GROUND_HEIGHT)-s/2;this.ctx.textAlign="center",this.ctx.font="36px 'Impact'",this.ctx.fillStyle="#c99868",this.ctx.beginPath(),this.ctx.roundRect(o,n,e,s,5),this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="white",this.ctx.save(),this.ctx.translate(o,n),this.ctx.scale(this.canvas.width/i.GRID_SIZE_X,this.canvas.height/i.GRID_SIZE_Y),this.ctx.fillText("Score:",e/2,s/2),this.ctx.strokeText("Score:",e/2,s/2),this.ctx.fillText(`${t.getScore()}`,e/2,s/3),this.ctx.strokeText(`${t.getScore()}`,e/2,s/3),this.ctx.restore()}renderScore(){let t=this.game.getPlayer();this.ctx.textAlign="center",this.ctx.fillStyle="white",this.ctx.font="48px 'Impact'";let e=this.toScreenX(i.GRID_SIZE_X/2),s=this.toScreenY(i.GRID_SIZE_Y)-this.toScreenHeight(200);this.ctx.fillText(`${t.getScore()}`,e,s),this.ctx.strokeText(`${t.getScore()}`,e,s)}drawBackground(){this.ctx.lineWidth=this.toScreenWidth(2),this.ctx.strokeStyle="#121212",this.ctx.fillStyle="#8dcdff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#ffe284",this.ctx.fillRect(0,this.canvas.height-i.GROUND_HEIGHT*this.cellSizeY(),this.canvas.width,i.GROUND_HEIGHT*this.cellSizeY()),this.ctx.strokeRect(0,this.canvas.height-i.GROUND_HEIGHT*this.cellSizeY(),this.canvas.width,i.GROUND_HEIGHT*this.cellSizeY())}};var f=class{constructor(t){this.game=t}processClick(){this.game.gameState()===0&&this.game.setGameState(1),this.game.gameState()!==2?this.game.getPlayer().jump():this.game.restart()}};var I=class{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}getY(){return this.y}setX(t){this.x=t}setY(t){this.y=t}moveX(t){this.x+=t}moveY(t){this.y+=t}};var m=class{constructor(t,e,s,o){this.velocityX=0;this.velocityY=0;this.accelerationX=0;this.accelerationY=0;this.position=new I(t,e),this.width=s,this.height=o}updatePosition(t){this.velocityX+=this.accelerationX*t,this.velocityY+=this.accelerationY*t,!(this.position.getY()<i.GROUND_HEIGHT)&&(this.position.moveX(this.velocityX*t),this.position.moveY(this.velocityY*t))}intersects(t){let e=this.position.getX(),s=this.position.getY(),o=this.position.getX()+this.width,n=this.position.getY()+this.height,r=t.getPosition().getX(),a=t.getPosition().getY(),l=t.getPosition().getX()+t.getWidth(),h=t.getPosition().getY()+t.getHeight();return e<=l&&o>=r&&s<=h&&n>=a}setVelocityX(t){this.velocityX=t}setVelocityY(t){this.velocityY=t}setAccelerationX(t){this.accelerationX=t}setAccelerationY(t){this.accelerationY=t}getWidth(){return this.width}getHeight(){return this.height}getPosition(){return this.position}getAccelerationY(){return this.accelerationY}getVelocityY(){return this.velocityY}};var g=class{constructor(){this.score=0;this.pointAwarded=!1;this.movableComponent=new m(i.GRID_SIZE_X/5,i.GRID_SIZE_Y/2,90,90),this.movableComponent.setAccelerationY(i.GRAVITY),this.birb=new Image(421,436),this.birb.src="./images/birb.png"}render(t){let e=t.canvasRenderingContext2D(),s=t.toScreenWidth(this.movableComponent.getWidth()),o=t.toScreenHeight(this.movableComponent.getHeight()),n=t.toScreenX(this.movableComponent.getPosition().getX()),r=t.toScreenY(this.movableComponent.getPosition().getY());e.save(),e.translate(n+s/2,r+o/2),e.rotate(this.getRotation()),e.drawImage(this.birb,-(s/2),-(o/2),s,o),e.restore()}getScore(){return this.score}increaseScore(){this.score+=1}getMovableComponent(){return this.movableComponent}setPointAwarded(t){this.pointAwarded=t}getPointAwarded(){return this.pointAwarded}getX(){return this.movableComponent.getPosition().getX()}jump(){this.movableComponent.setVelocityY(i.JUMP_VELOCITY)}getRotation(){let t=this.movableComponent.getVelocityY();return t>200?-(Math.PI/6):t<-100?Math.PI/3:0}};var b=class{constructor(t,e,s,o){this.movableComponent=new m(t,e,s,o),this.movableComponent.setVelocityX(i.OBSTACLE_VELOCITY)}render(t){this.renderObstacle(t),this.renderObstacleEntrance(t)}renderObstacle(t){let e=t.canvasRenderingContext2D(),s=t.toScreenX(this.getPosition().getX()),o=t.toScreenY(this.getPosition().getY()),n=t.toScreenWidth(this.movableComponent.getWidth()),r=t.toScreenHeight(this.movableComponent.getHeight()),a=e.createLinearGradient(s,0,s+n,0);a.addColorStop(0,"#84c887"),a.addColorStop(.2,"#6fbf73"),a.addColorStop(.3,"#6fbf73"),a.addColorStop(.5,"#4caf50"),a.addColorStop(.8,"#357a38"),a.addColorStop(1,"#4caf50"),e.fillStyle=a,e.fillRect(s,o,n,r),e.strokeRect(s,o,n,r)}renderObstacleEntrance(t){let e=t.canvasRenderingContext2D(),s=t.toScreenY(this.getPosition().getY()),o=t.toScreenHeight(this.movableComponent.getHeight()),n=i.OBSTACLE_WIDTH+20,r=(n-i.OBSTACLE_WIDTH)/2,a=this.getPosition().getX()-r,l=t.toScreenX(a),h=t.toScreenWidth(n),p=t.toScreenHeight(30);if(this.getPosition().getY()===i.GROUND_HEIGHT){let x=s+o-p;e.fillRect(l,x,h,p),e.strokeRect(l,x,h,p)}else e.fillRect(l,s,h,p),e.strokeRect(l,s,h,p)}getMovableComponent(){return this.movableComponent}getPosition(){return this.movableComponent.getPosition()}getWidth(){return this.movableComponent.getWidth()}getHeight(){return this.movableComponent.getHeight()}};var u=class{constructor(t){this.game=t,this.obstacles=new Array,this.obstacleTimer=0}getObstacles(){return this.obstacles}update(t){this.game.gameState()===1&&this.processObstacles(t)}processObstacles(t){let e=this.game.getPlayer();for(let s=this.obstacles.length-1;s>=0;s--){let o=this.obstacles[s];if(o.getPosition().getX()+o.getWidth()<=0){this.obstacles.splice(s,1);continue}if(s<2&&o.getMovableComponent().intersects(this.game.getPlayer().getMovableComponent())){this.game.setGameState(2);continue}s==0&&(!e.getPointAwarded()&&e.getX()>o.getPosition().getX()&&e.getX()<o.getPosition().getX()+o.getWidth()?(e.setPointAwarded(!0),e.increaseScore()):e.getX()>o.getPosition().getX()+o.getWidth()&&e.setPointAwarded(!1)),o.getMovableComponent().updatePosition(t)}this.handleObstacleSpawning(t)}handleObstacleSpawning(t){this.obstacleTimer+=t,this.obstacleTimer>2&&(this.spawnObstacle(),this.obstacleTimer=0)}spawnObstacle(){let t=i.OBSTACLE_OPENING+40,e=i.GRID_SIZE_Y-i.GROUND_HEIGHT-i.OBSTACLE_OPENING,s=Math.floor(Math.random()*(e-t+1)+t),o=i.GRID_SIZE_Y-i.GROUND_HEIGHT-s,n=new b(i.GRID_SIZE_X,i.GRID_SIZE_Y-o,i.OBSTACLE_WIDTH,o),r=new b(i.GRID_SIZE_X,i.GROUND_HEIGHT,i.OBSTACLE_WIDTH,s-i.OBSTACLE_OPENING);this.obstacles.push(n),this.obstacles.push(r)}};var d=class{constructor(t){this.game=t}update(t){let e=this.game.getPlayer();this.game.gameState()!==0&&e.getMovableComponent().updatePosition(t),this.game.gameState()!==2&&e.getMovableComponent().getPosition().getY()<=i.GROUND_HEIGHT&&this.game.setGameState(2)}};var G=class{constructor(){this.tick=t=>{this.deltaTime=(t-this.timestampOld)/1e3,this.timestampOld=t,this.playerManager.update(this.deltaTime),this.obstacleManager.update(this.deltaTime),this.gameRenderer.render(),window.requestAnimationFrame(this.tick)};this.player=new g,this.inputHandler=new f(this),this.gameRenderer=new v(this),this.obstacleManager=new u(this),this.playerManager=new d(this),this.state=0,this.deltaTime=0,this.timestampOld=0}restart(){this.player=new g,this.state=0,this.obstacleManager=new u(this),this.playerManager=new d(this),this.deltaTime=0,this.timestampOld=0}getPlayer(){return this.player}getInputHandler(){return this.inputHandler}gameState(){return this.state}setGameState(t){this.state=t}getTimeDelta(){return this.deltaTime}getObstacleManager(){return this.obstacleManager}getPlayerManager(){return this.playerManager}renderer(){return this.gameRenderer}};var C;function E(){C=new G,window.requestAnimationFrame(C.tick)}window.onload=E;})();
