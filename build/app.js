"use strict";(()=>{var e=class{static{this.GRID_SIZE_X=480}static{this.GRID_SIZE_Y=854}static{this.OBSTACLE_OPENING=226}static{this.OBSTACLE_WIDTH=100}static{this.OBSTACLE_VELOCITY=-250}static{this.GROUND_HEIGHT=100}static{this.GRAVITY=-2250}static{this.JUMP_VELOCITY=800}};var S=class{constructor(t){this.game=t,this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d");let i=this.canvas.width/e.GRID_SIZE_X,o=this.canvas.height/e.GRID_SIZE_Y;this.ctx.scale(i,o),this.canvas.addEventListener("touchstart",r=>{t.getInputHandler().processClick(),r.preventDefault()}),this.canvas.addEventListener("mousedown",()=>t.getInputHandler().processClick())}toScreenWidth(t){return t}toScreenHeight(t){return-t}toScreenX(t){return t}toScreenY(t){return e.GRID_SIZE_Y-t}canvasRenderingContext2D(){return this.ctx}render(){this.drawBackground(),this.game.getGround().render(this,this.game.getTimeDelta());let t=this.game.getObstacleManager().getObstacles();for(let i=t.length-1;i>=0;i--)t[i].getRenderer().render(this);this.game.getPlayer().getRenderer().render(this,this.game.getTimeDelta()),this.game.gameState()!==2?this.renderScore():this.renderGameOverScreen(),this.renderDebug()}renderDebug(){this.ctx.textAlign="left",this.ctx.fillStyle="black",this.ctx.font="24px 'Roboto'",this.ctx.fillText(`FPS: ${Math.floor(1/this.game.getTimeDelta())}`,10,30)}renderGameOverScreen(){let t=this.game.getPlayer(),i=this.toScreenWidth(e.GRID_SIZE_X/2),o=this.toScreenHeight(e.GRID_SIZE_Y/5),r=this.toScreenX(e.GRID_SIZE_X/2)-i/2,s=this.toScreenY(e.GRID_SIZE_Y/2)+this.toScreenHeight(e.GROUND_HEIGHT)-o/2;this.ctx.textAlign="center",this.ctx.font="42px 'Franklin Gothic'",this.ctx.fillStyle="#c99868",this.ctx.beginPath(),this.ctx.roundRect(r,s,i,o,5),this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="white",this.ctx.save(),this.ctx.translate(r,s),this.ctx.fillText("Score:",i/2,o/2-30),this.ctx.strokeText("Score:",i/2,o/2-30),this.ctx.fillText(`${t.getScore()}`,i/2,o/3),this.ctx.strokeText(`${t.getScore()}`,i/2,o/3),this.ctx.restore()}renderScore(){let t=this.game.getPlayer();this.ctx.textAlign="center",this.ctx.fillStyle="white",this.ctx.font="68px 'Impact'",this.ctx.fillText(`${t.getScore()}`,e.GRID_SIZE_X/2,e.GRID_SIZE_Y/8),this.ctx.strokeText(`${t.getScore()}`,e.GRID_SIZE_X/2,e.GRID_SIZE_Y/8)}drawBackground(){this.ctx.lineWidth=2,this.ctx.strokeStyle="#121212",this.ctx.fillStyle="#8dcdff",this.ctx.fillRect(0,0,e.GRID_SIZE_X,e.GRID_SIZE_Y)}};var G=class{constructor(t){this.game=t}processClick(){this.game.gameState()===0&&this.game.setGameState(1),this.game.gameState()!==2?this.game.getPlayer().jump():this.game.restart()}};var R=class{constructor(t,i){this.x=t,this.y=i}getX(){return this.x}getY(){return this.y}setX(t){this.x=t}setY(t){this.y=t}moveX(t){this.x+=t}moveY(t){this.y+=t}};var p=class{constructor(t,i,o,r){this.velocityX=0;this.velocityY=0;this.accelerationX=0;this.accelerationY=0;this.position=new R(t,i),this.width=o,this.height=r}updatePosition(t){if(this.velocityX+=this.accelerationX*t,this.velocityY+=this.accelerationY*t,this.velocityY<-850&&(this.velocityY=-850),this.position.moveX(this.velocityX*t),this.position.getY()+this.velocityY*t>e.GRID_SIZE_Y){this.position.setY(e.GRID_SIZE_Y);return}if(this.position.getY()+this.velocityY*t<e.GROUND_HEIGHT){this.position.setY(e.GROUND_HEIGHT);return}this.position.moveY(this.velocityY*t)}intersects(t){let i=this.position.getX(),o=this.position.getY(),r=this.position.getX()+this.width,s=this.position.getY()+this.height,a=t.getPosition().getX(),c=t.getPosition().getY(),m=t.getPosition().getX()+t.getWidth(),l=t.getPosition().getY()+t.getHeight();return i<=m&&r>=a&&o<=l&&s>=c}setVelocityX(t){this.velocityX=t}setVelocityY(t){this.velocityY=t}setAccelerationX(t){this.accelerationX=t}setAccelerationY(t){this.accelerationY=t}getWidth(){return this.width}getHeight(){return this.height}getPosition(){return this.position}getAccelerationY(){return this.accelerationY}getVelocityY(){return this.velocityY}};var _=class{constructor(t){this.player=t;let i=new Image;i.src="./images/birb_1.png";let o=new Image;o.src="./images/birb_2.png",this.sprites=new Array(i,o),this.spriteSwitchTimer=0,this.spriteIndex=0}render(t,i){let o=this.player.getMovableComponent(),r=t.canvasRenderingContext2D(),s=t.toScreenWidth(o.getWidth()),a=t.toScreenHeight(o.getHeight()),c=t.toScreenX(o.getPosition().getX()),m=t.toScreenY(o.getPosition().getY());r.save(),r.translate(c+s/2,m+a/2),r.rotate(this.getRotation()),r.drawImage(this.sprites[this.spriteIndex],-(s/2),-(a/2),s,a),this.spriteSwitchTimer+=i,this.spriteSwitchTimer>=.1&&(this.spriteIndex=(this.spriteIndex+1)%this.sprites.length,this.spriteSwitchTimer=0),r.restore()}getRotation(){let t=this.player.getMovableComponent().getVelocityY();return t>200?-(Math.PI/6):t<-700?Math.PI/3:(t<-600,0)}};var b=class{constructor(){this.score=0;this.pointAwarded=!1;this.renderer=new _(this),this.movableComponent=new p(e.GRID_SIZE_X/4,e.GRID_SIZE_Y/2,68,48),this.movableComponent.setAccelerationY(e.GRAVITY)}getScore(){return this.score}increaseScore(){this.score+=1}getMovableComponent(){return this.movableComponent}setPointAwarded(t){this.pointAwarded=t}getPointAwarded(){return this.pointAwarded}getX(){return this.movableComponent.getPosition().getX()}getRenderer(){return this.renderer}jump(){this.movableComponent.setVelocityY(e.JUMP_VELOCITY)}};var E=class{constructor(t){this.obstacle=t}render(t){this.renderObstacle(t),this.renderObstacleEntrance(t)}renderObstacle(t){let i=t.canvasRenderingContext2D(),o=this.obstacle.getPosition(),r=this.obstacle.getMovableComponent(),s=t.toScreenX(o.getX()),a=t.toScreenY(o.getY()),c=t.toScreenWidth(r.getWidth()),m=t.toScreenHeight(r.getHeight()),l=i.createLinearGradient(s,0,s+c,0);l.addColorStop(0,"#84c887"),l.addColorStop(.2,"#6fbf73"),l.addColorStop(.3,"#6fbf73"),l.addColorStop(.5,"#4caf50"),l.addColorStop(.8,"#357a38"),l.addColorStop(1,"#4caf50"),i.fillStyle=l,i.lineWidth=2,i.fillRect(s,a,c,m),i.strokeRect(s,a,c,m)}renderObstacleEntrance(t){let i=t.canvasRenderingContext2D(),o=this.obstacle.getPosition(),r=this.obstacle.getMovableComponent(),s=t.toScreenY(o.getY()),a=t.toScreenHeight(r.getHeight()),c=e.OBSTACLE_WIDTH+10,m=(c-e.OBSTACLE_WIDTH)/2,l=o.getX()-m,I=t.toScreenX(l),f=t.toScreenWidth(c),h=t.toScreenHeight(30);if(o.getY()===e.GROUND_HEIGHT){let y=s+a-h;i.fillRect(I,y,f,h),i.strokeRect(I,y,f,h)}else i.fillRect(I,s,f,h),i.strokeRect(I,s,f,h)}};var u=class{constructor(t,i,o,r){this.renderer=new E(this),this.movableComponent=new p(t,i,o,r),this.movableComponent.setVelocityX(e.OBSTACLE_VELOCITY)}getMovableComponent(){return this.movableComponent}getPosition(){return this.movableComponent.getPosition()}getWidth(){return this.movableComponent.getWidth()}getHeight(){return this.movableComponent.getHeight()}getRenderer(){return this.renderer}};var d=class{constructor(t){this.game=t,this.obstacles=new Array,this.obstacleTimer=0}getObstacles(){return this.obstacles}update(t){this.game.gameState()===1&&this.processObstacles(t)}processObstacles(t){let i=this.game.getPlayer();for(let o=this.obstacles.length-1;o>=0;o--){let r=this.obstacles[o];if(r.getPosition().getX()+r.getWidth()<=0){this.obstacles.splice(o,1);continue}if(o<2&&r.getMovableComponent().intersects(this.game.getPlayer().getMovableComponent())){this.game.setGameState(2);continue}o==0&&(!i.getPointAwarded()&&i.getX()>r.getPosition().getX()&&i.getX()<r.getPosition().getX()+r.getWidth()?(i.setPointAwarded(!0),i.increaseScore()):i.getX()>r.getPosition().getX()+r.getWidth()&&i.setPointAwarded(!1)),r.getMovableComponent().updatePosition(t)}this.handleObstacleSpawning(t)}handleObstacleSpawning(t){this.obstacleTimer+=t,this.obstacleTimer>=1.5&&(this.spawnObstacle(),this.obstacleTimer=0)}spawnObstacle(){let i=e.GRID_SIZE_Y-e.OBSTACLE_OPENING-e.GROUND_HEIGHT-160,o=Math.floor(Math.random()*(i+1)),r=80+o%i,s=80+i-o%i,a=new u(e.GRID_SIZE_X,0,e.OBSTACLE_WIDTH,r),c=new u(e.GRID_SIZE_X,e.GRID_SIZE_Y-s,e.OBSTACLE_WIDTH,s);this.obstacles.push(a),this.obstacles.push(c)}};var v=class{constructor(t){this.game=t}update(t){let i=this.game.getPlayer();this.game.gameState()!==0&&i.getMovableComponent().updatePosition(t),this.game.gameState()!==2&&i.getMovableComponent().getPosition().getY()<=e.GROUND_HEIGHT&&this.game.setGameState(2)}};var x=class{constructor(t){this.game=t,this.movableComponent=new p(0,e.GROUND_HEIGHT,0,0),this.movableComponent.setVelocityX(e.OBSTACLE_VELOCITY),this.sprite=new Image,this.sprite.src="./images/ground.svg"}update(t){this.game.gameState()!==2&&this.movableComponent.updatePosition(t),this.movableComponent.getPosition().getX()<-158&&this.movableComponent.getPosition().setX(0)}render(t,i){let o=t.canvasRenderingContext2D();o.fillStyle="#ffe284",o.fillRect(0,e.GRID_SIZE_Y-e.GROUND_HEIGHT,e.GRID_SIZE_X,e.GROUND_HEIGHT),o.drawImage(this.sprite,this.movableComponent.getPosition().getX(),t.toScreenY(e.GROUND_HEIGHT)),o.strokeRect(0,e.GRID_SIZE_Y-e.GROUND_HEIGHT,e.GRID_SIZE_X,e.GROUND_HEIGHT)}};var C=class{constructor(){this.tick=t=>{this.deltaTime=(t-this.timestampOld)/1e3,this.timestampOld=t,this.playerManager.update(this.deltaTime),this.obstacleManager.update(this.deltaTime),this.ground.update(this.deltaTime),this.gameRenderer.render(),window.requestAnimationFrame(this.tick)};this.player=new b,this.inputHandler=new G(this),this.gameRenderer=new S(this),this.obstacleManager=new d(this),this.playerManager=new v(this),this.ground=new x(this),this.state=0,this.deltaTime=0,this.timestampOld=0}restart(){this.player=new b,this.state=0,this.obstacleManager=new d(this),this.playerManager=new v(this),this.deltaTime=0,this.timestampOld=0}getPlayer(){return this.player}getInputHandler(){return this.inputHandler}gameState(){return this.state}setGameState(t){this.state=t}getTimeDelta(){return this.deltaTime}getObstacleManager(){return this.obstacleManager}getPlayerManager(){return this.playerManager}getGround(){return this.ground}renderer(){return this.gameRenderer}};var Y;function O(){Y=new C,window.requestAnimationFrame(Y.tick)}window.onload=O;})();
